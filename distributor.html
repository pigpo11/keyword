<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>광고그룹 키워드 분배기 | Premium Tool</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-hover: #7c3aed;
            --bg: #fdf2f8;
            /* Light pink/purple bg for distinction */
            --card-bg: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --radius: 16px;
            --shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: var(--text);
            padding: 2rem;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        nav {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: #e2e8f0;
            color: var(--text);
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        header {
            margin-bottom: 3rem;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card h3 .step {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .textarea-wrapper {
            position: relative;
        }

        textarea {
            width: 100%;
            height: 350px;
            padding: 1rem;
            border: 2px solid #f1f5f9;
            border-radius: 12px;
            font-size: 0.95rem;
            resize: none;
            outline: none;
            transition: all 0.2s;
            background: #f8fafc;
        }

        textarea:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 0.75rem;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .count-val {
            font-weight: 700;
            color: var(--primary);
        }

        .action-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            margin-top: 3rem;
            padding: 2rem;
            background: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        .btn {
            padding: 1rem 3rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(139, 92, 246, 0.39);
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.45);
        }

        .btn-primary:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-summary {
            display: none;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .download-options {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
        }

        .btn-outline:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .tip {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 0.5rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <nav>
            <a href="index.html" class="nav-link">조합기</a>
            <a href="distributor.html" class="nav-link active">분배기 (1,000개씩)</a>
        </nav>

        <header>
            <h1>키워드 분배기</h1>
            <p>광고그룹 ID별로 키워드를 1,000개씩 자동으로 배분합니다.</p>
        </header>

        <div class="main-grid">
            <div class="card">
                <h3><span class="step">1</span> 광고그룹 ID 입력</h3>
                <div class="textarea-wrapper">
                    <textarea id="group-ids" placeholder="광고그룹 ID를 한 줄에 하나씩 입력하세요..."></textarea>
                </div>
                <div class="info-bar">
                    <span>입력된 그룹 수</span>
                    <span id="group-count" class="count-val">0</span>
                </div>
                <p class="tip">예: grp_001, grp_002 ...</p>
            </div>

            <div class="card">
                <h3><span class="step">2</span> 키워드 입력</h3>
                <div class="textarea-wrapper">
                    <textarea id="keywords" placeholder="키워드를 한 줄에 하나씩 입력하세요..."></textarea>
                </div>
                <div class="info-bar">
                    <span>입력된 키워드 수</span>
                    <span id="kw-count" class="count-val">0</span>
                </div>
                <p class="tip">입력된 키워드 순서대로 1,000개씩 배분됩니다.</p>
            </div>
        </div>

        <div class="action-section">
            <div id="status-text" style="color: var(--text-light); text-align: center; margin-bottom: 1rem;">
                입력 대기 중...
            </div>

            <button class="btn btn-primary" id="process-btn" onclick="startDistribution()">
                분배 및 다운로드 준비
            </button>

            <div class="result-summary" id="result-summary">
                <div style="font-size: 1.2rem; font-weight: 700; color: #10b981; margin-bottom: 1rem;">
                    ✓ 분배가 완료되었습니다!
                </div>
                <p id="calc-result" style="margin-bottom: 1.5rem;"></p>
                <div class="download-options">
                    <button class="btn btn-outline" onclick="downloadAllInOne()">통합 CSV 다운로드</button>
                    <button class="btn btn-outline" onclick="downloadIndividualFiles()">개별 TXT 다운로드 (ZIP)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JSZip library for zip download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        const groupIdsInput = document.getElementById('group-ids');
        const keywordsInput = document.getElementById('keywords');
        const groupCountDisp = document.getElementById('group-count');
        const kwCountDisp = document.getElementById('kw-count');
        const summaryDiv = document.getElementById('result-summary');
        const calcResultP = document.getElementById('calc-result');

        let distributedData = []; // [{groupId: '', keywords: []}]

        // Real-time counting
        [groupIdsInput, keywordsInput].forEach(el => {
            el.addEventListener('input', () => {
                const groups = groupIdsInput.value.split('\n').map(s => s.trim()).filter(s => s);
                const kws = keywordsInput.value.split('\n').map(s => s.trim()).filter(s => s);

                groupCountDisp.innerText = groups.length.toLocaleString();
                kwCountDisp.innerText = kws.length.toLocaleString();

                summaryDiv.style.display = 'none';
                document.getElementById('status-text').style.display = 'block';
            });
        });

        function startDistribution() {
            const groups = groupIdsInput.value.split('\n').map(s => s.trim()).filter(s => s);
            const kws = keywordsInput.value.split('\n').map(s => s.trim()).filter(s => s);

            if (groups.length === 0) {
                alert('광고그룹 ID를 입력해주세요.');
                return;
            }
            if (kws.length === 0) {
                alert('키워드를 입력해주세요.');
                return;
            }

            distributedData = [];
            const CHUNK_SIZE = 1000;

            for (let i = 0; i < groups.length; i++) {
                const start = i * CHUNK_SIZE;
                const end = start + CHUNK_SIZE;
                const chunk = kws.slice(start, end);

                if (chunk.length > 0) {
                    distributedData.push({
                        groupId: groups[i],
                        keywords: chunk
                    });
                }
            }

            // Summary UI
            const usedGroups = distributedData.length;
            const totalUsedKws = distributedData.reduce((acc, curr) => acc + curr.keywords.length, 0);

            calcResultP.innerHTML = `총 <b>${usedGroups}</b>개 그룹에 <b>${totalUsedKws.toLocaleString()}</b>개 키워드가 분배되었습니다.<br>${usedGroups < groups.length ? `<span style="color: #ef4444; font-size: 0.9rem;">(키워드가 부족하여 ${groups.length - usedGroups}개 그룹은 제외되었습니다)</span>` : ''}`;

            summaryDiv.style.display = 'block';
            document.getElementById('status-text').style.display = 'none';

            // Scroll to summary
            summaryDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function downloadAllInOne() {
            if (distributedData.length === 0) return;

            let csvContent = "Ad Group ID,Keyword\n";
            distributedData.forEach(item => {
                item.keywords.forEach(kw => {
                    // Simple escape
                    const escapedKw = kw.includes(',') ? `"${kw}"` : kw;
                    csvContent += `${item.groupId},${escapedKw}\n`;
                });
            });

            const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `distribute_all_${new Date().toISOString().slice(0, 10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function downloadIndividualFiles() {
            if (distributedData.length === 0) return;

            const zip = new JSZip();

            distributedData.forEach(item => {
                const content = item.keywords.join('\n');
                zip.file(`${item.groupId}_keywords.txt`, content);
            });

            const content = await zip.generateAsync({ type: "blob" });
            const url = URL.createObjectURL(content);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `distribute_files_${new Date().getTime()}.zip`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>

</html>